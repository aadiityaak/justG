(function(t){"use strict";var e={storeCountry:function(){e.getCountry().length||t.getJSON(justg_params.json.country_url,function(t){t.sort(function(t,e){return t.country_name>e.country_name?1:e.country_name>t.country_name?-1:0}),Lockr.set(justg_params.json.country_key,t)})},getCountry:function(t,i){var r=Lockr.get(justg_params.json.country_key);return r&&void 0!==r?t&&t===Object(t)?e.searchLocation(r,t,i):r:[]},storeProvince:function(){e.getProvince().length||t.getJSON(justg_params.json.province_url,function(t){t.sort(function(t,e){return t.province_name>e.province_name?1:e.province_name>t.province_name?-1:0}),Lockr.set(justg_params.json.province_key,t)})},getProvince:function(t,i){var r=Lockr.get(justg_params.json.province_key);return r&&void 0!==r?t&&t===Object(t)?e.searchLocation(r,t,i):r:[]},storeCity:function(){e.getCity().length||t.getJSON(justg_params.json.city_url,function(t){t.sort(function(t,e){return t.city_name>e.city_name?1:e.city_name>t.city_name?-1:0}),Lockr.set(justg_params.json.city_key,t)})},getCity:function(t,i){var r=Lockr.get(justg_params.json.city_key);return r&&void 0!==r?t&&t===Object(t)?e.searchLocation(r,t,i):r:[]},storeSubdistrict:function(){e.getSubdistrict().length||t.getJSON(justg_params.json.subdistrict_url,function(t){t.sort(function(t,e){return t.subdistrict_name>e.subdistrict_name?1:e.subdistrict_name>t.subdistrict_name?-1:0}),Lockr.set(justg_params.json.subdistrict_key,t)})},getSubdistrict:function(t,i){var r=Lockr.get(justg_params.json.subdistrict_key);return r&&void 0!==r?t&&t===Object(t)?e.searchLocation(r,t,i):r:[]},searchLocation:function(t,i,r){return"filter"===r?t.filter(function(t){return e.isLocationMatch(t,i)}):t.find(function(t){return e.isLocationMatch(t,i)})},isLocationMatch:function(t,e){var i=!0;for(var r in e)t.hasOwnProperty(r)&&String(t[r]).toLowerCase()===String(e[r]).toLowerCase()||(i=!1);return i}};e.storeCountry(),e.storeProvince(),e.storeCity(),e.storeSubdistrict();var i={init:function(){t(document.body).on("country_to_state_changed",function(){var e=i.getFields();t("select.country_to_state, input.country_to_state").each(function(){var r=t(this),n=r.attr("id").replace("_country",""),o=r.val();_.each(e,function(e){e.callback&&t("#"+n+"_"+e.suffix).off("change",e.callback)}),"ID"===o?(i.modifyForm(n),_.each(e,function(e){e.callback&&t("#"+n+"_"+e.suffix).on("change",e.callback)}),_.each(e,function(e){e.triggerEvent&&t("#"+n+"_"+e.suffix).trigger(e.triggerEvent)})):i.restoreForm(n)})})},onChangeStateField:function(r){var n=t(r.currentTarget),o=n.attr("id").replace("_state",""),c=n.val(),a=[],s=e.getProvince({code:c});if(s){var u=e.getCity({province_id:s.province_id},"filter");if(u)for(var d=0;d<u.length;d++){var f=u[d].type+" "+u[d].city_name;a.push({id:f,text:f})}}var l=t("#"+o+"_city").val();t("#"+o+"_city").empty().selectWoo({width:"100%",data:a,placeholder:i.getFields({suffix:"city"}).placeholder}).val(l).trigger("change")},onChangeCityField:function(r){var n=t(r.currentTarget),o=n.attr("id").replace("_city",""),c=t("#"+o+"_state"),a=c.val(),s=n.val(),u=[],d=e.getProvince({code:a});if(d&&s){var f=s.split(" ")[0],l=s.split(" ").splice(1).join(" "),_=e.getCity({type:f,city_name:l,province_id:d.province_id});if(_){var g=e.getSubdistrict({province_id:d.province_id,city_id:_.city_id},"filter");if(g)for(var p=0;p<g.length;p++)u.push({id:g[p].subdistrict_name,text:g[p].subdistrict_name})}}var v=t("#"+o+"_address_2").val();t("#"+o+"_address_2").empty().selectWoo({width:"100%",data:u,placeholder:i.getFields({suffix:"address_2"}).placeholder}).val(v).trigger("change")},onChangeSubdistrictField:function(e){var i=function(){var i=t("#ship-to-different-address-checkbox").is(":checked"),r=t(e.currentTarget).attr("id").replace("_address_2","");return"billing"===r&&!i||!("shipping"!==r||!i)};i()&&t(document.body).trigger("update_checkout")},modifyForm:function(e){_.each(i.getFields(),function(r){if(r.modifyForm){var n=t("#"+e+"_"+r.suffix);if(!n||!n.length){var o=t("#"+e+"_postcode_field");if(o&&o.length){var c=o.clone().attr({id:e+"_"+r.suffix+"_field"});c.find("input").attr({id:e+"_"+r.suffix,name:e+"_"+r.suffix,value:t("#justg_"+e+"_"+r.suffix).val(),placeholder:r.placeholder||"","data-placeholder":r.placeholder||""}),o.before(c),n=c.find("input")}}if(n&&n.length){if(!n.is("select")){var a=n.val(),s=_.omit(i.getFieldAttributes(n),["type"]);n.replaceWith(t("<select></select>").attr(s).append(t('<option value="'+a+'">'+a+"</option>")))}n=t("#"+e+"_"+r.suffix),n.removeClass("input-text"),n.selectWoo({width:"100%"})}}})},restoreForm:function(e){_.each(i.getFields(),function(r){if(r.modifyForm){var n=t("#"+e+"_"+r.suffix);if(n.is("select")){n.selectWoo("destroy");var o=_.extend(i.getFieldAttributes(n),{type:"text"});n.replaceWith(t("<input>").attr(o)),n=t("#"+e+"_"+r.suffix),n.addClass("input-text"),"calc_shipping"===e&&"address_2"===r.suffix&&n.closest(".form-row").remove()}}})},getFields:function(t){var e=[{suffix:"state",callback:i.onChangeStateField,triggerEvent:"change"},{suffix:"city",callback:i.onChangeCityField,modifyForm:!0,placeholder:justg_params.text.placeholder.city},{suffix:"address_2",callback:i.onChangeSubdistrictField,modifyForm:!0,placeholder:justg_params.text.placeholder.address_2}];return t?_.find(e,t):e},getFieldAttributes:function(t){var e={};return _.each(t[0].attributes,function(t){e[t.name]=t.value}),e}};t(document.body).on("wc_address_i18n_ready",function(){i.init(),setTimeout(function(){t(document.body).trigger("country_to_state_changed")},100)})})(jQuery);